/* SmoothScroll v1.2.1 - Licensed under the terms of the MIT license. */
var defaultOptions={frameRate:150,animationTime:650,stepSize:120,pulseAlgorithm:true,pulseScale:7,pulseNormalize:1,accelerationDelta:20,accelerationMax:1,keyboardSupport:true,arrowScroll:50,touchpadSupport:true,fixedBackground:true,excluded:""};var options=defaultOptions;var isExcluded=false;var isFrame=false;var direction={x:0,y:0};var initDone=false;var root=document.documentElement;var activeElement;var observer;var deltaBuffer=[120,120,120];var key={left:37,up:38,right:39,down:40,spacebar:32,pageup:33,pagedown:34,end:35,home:36};function initTest(){var c=false;if(document.URL.indexOf("google.com/reader/view")>-1){c=true;}if(options.excluded){var a=options.excluded.split(/[,\n] ?/);a.push("mail.google.com");for(var b=a.length;b--;){if(document.URL.indexOf(a[b])>-1){observer&&observer.disconnect();removeEvent("mousewheel",wheel);c=true;isExcluded=true;break;}}}if(c){removeEvent("keydown",keydown);}if(options.keyboardSupport&&!c){addEvent("keydown",keydown);}}function init(){if(!document.body){return;}var f=document.body;var e=document.documentElement;var a=window.innerHeight;var j=f.scrollHeight;root=(document.compatMode.indexOf("CSS")>=0)?e:f;activeElement=f;initTest();initDone=true;if(top!=self){isFrame=true;}else{if(j>a&&(f.offsetHeight<=a||e.offsetHeight<=a)){var b=false;var g=function(){if(!b&&e.scrollHeight!=document.height){b=true;setTimeout(function(){e.style.height=document.height+"px";b=false;},500);}};e.style.height="auto";setTimeout(g,10);var d={attributes:true,childList:true,characterData:false};observer=new MutationObserver(g);observer.observe(f,d);if(root.offsetHeight<=a){var c=document.createElement("div");c.style.clear="both";f.appendChild(c);}}}if(document.URL.indexOf("mail.google.com")>-1){var i=document.createElement("style");i.innerHTML=".iu { visibility: hidden }";(document.getElementsByTagName("head")[0]||e).appendChild(i);}else{if(document.URL.indexOf("www.facebook.com")>-1){var h=document.getElementById("home_stream");h&&(h.style.webkitTransform="translateZ(0)");}}if(!options.fixedBackground&&!isExcluded){f.style.backgroundAttachment="scroll";e.style.backgroundAttachment="scroll";}}var que=[];var pending=false;var lastScroll=+new Date;function scrollArray(d,c,h,e){e||(e=1000);directionCheck(c,h);if(options.accelerationMax!=1){var a=+new Date;var i=a-lastScroll;if(i<options.accelerationDelta){var f=(1+(30/i))/2;if(f>1){f=Math.min(f,options.accelerationMax);c*=f;h*=f;}}lastScroll=+new Date;}que.push({x:c,y:h,lastX:(c<0)?0.99:-0.99,lastY:(h<0)?0.99:-0.99,start:+new Date});if(pending){return;}var g=(d===document.body);var b=function(k){var j=+new Date;var r=0;var q=0;for(var m=0;m<que.length;m++){var t=que[m];var s=j-t.start;var l=(s>=options.animationTime);var n=(l)?1:s/options.animationTime;if(options.pulseAlgorithm){n=pulse(n);}var p=(t.x*n-t.lastX)>>0;var o=(t.y*n-t.lastY)>>0;r+=p;q+=o;t.lastX+=p;t.lastY+=o;if(l){que.splice(m,1);m--;}}if(g){window.scrollBy(r,q);}else{if(r){d.scrollLeft+=r;}if(q){d.scrollTop+=q;}}if(!c&&!h){que=[];}if(que.length){requestFrame(b,d,(e/options.frameRate+1));}else{pending=false;}};requestFrame(b,d,0);pending=true;}function wheel(d){if(!initDone){init();}var e=d.target;var c=overflowingAncestor(e);if(!c||d.defaultPrevented||isNodeName(activeElement,"embed")||(isNodeName(e,"embed")&&/\.pdf/i.test(e.src))){return true;}var b=d.wheelDeltaX||0;var a=d.wheelDeltaY||0;if(!b&&!a){a=d.wheelDelta||0;}if(!options.touchpadSupport&&isTouchpad(a)){return true;}if(Math.abs(b)>1.2){b*=options.stepSize/120;}if(Math.abs(a)>1.2){a*=options.stepSize/120;}scrollArray(c,-b,-a);d.preventDefault();}function keydown(b){var g=b.target;var e=b.ctrlKey||b.altKey||b.metaKey||(b.shiftKey&&b.keyCode!==key.spacebar);if(/input|textarea|select|embed/i.test(g.nodeName)||g.isContentEditable||b.defaultPrevented||e){return true;}if(isNodeName(g,"button")&&b.keyCode===key.spacebar){return true;}var c,i=0,h=0;var d=overflowingAncestor(activeElement);var f=d.clientHeight;if(d==document.body){f=window.innerHeight;}switch(b.keyCode){case key.up:h=-options.arrowScroll;break;case key.down:h=options.arrowScroll;break;case key.spacebar:c=b.shiftKey?1:-1;h=-c*f*0.9;break;case key.pageup:h=-f*0.9;break;case key.pagedown:h=f*0.9;break;case key.home:h=-d.scrollTop;break;case key.end:var a=d.scrollHeight-d.scrollTop-f;h=(a>0)?a+10:0;break;case key.left:i=-options.arrowScroll;break;case key.right:i=options.arrowScroll;break;default:return true;}scrollArray(d,i,h);b.preventDefault();}function mousedown(a){activeElement=a.target;}var cache={};setInterval(function(){cache={};},10*1000);var uniqueID=(function(){var a=0;return function(b){return b.uniqueID||(b.uniqueID=a++);};})();function setCache(b,a){for(var c=b.length;c--;){cache[uniqueID(b[c])]=a;}return a;}function overflowingAncestor(d){var b=[];var a=root.scrollHeight;do{var c=cache[uniqueID(d)];if(c){return setCache(b,c);}b.push(d);if(a===d.scrollHeight){if(!isFrame||root.clientHeight+10<a){return setCache(b,document.body);}}else{if(d.clientHeight+10<d.scrollHeight){overflow=getComputedStyle(d,"").getPropertyValue("overflow-y");if(overflow==="scroll"||overflow==="auto"){return setCache(b,d);}}}}while(d=d.parentNode);}function addEvent(c,b,a){window.addEventListener(c,b,(a||false));}function removeEvent(c,b,a){window.removeEventListener(c,b,(a||false));}function isNodeName(b,a){return(b.nodeName||"").toLowerCase()===a.toLowerCase();}function directionCheck(a,b){a=(a>0)?1:-1;b=(b>0)?1:-1;if(direction.x!==a||direction.y!==b){direction.x=a;direction.y=b;que=[];lastScroll=0;}}var deltaBufferTimer;function isTouchpad(a){if(!a){return;}a=Math.abs(a);deltaBuffer.push(a);deltaBuffer.shift();clearTimeout(deltaBufferTimer);deltaBufferTimer=setTimeout(function(){chrome.storage.local.set({deltaBuffer:deltaBuffer});},1000);var c=(deltaBuffer[0]==deltaBuffer[1]&&deltaBuffer[1]==deltaBuffer[2]);var b=(isDivisible(deltaBuffer[0],120)&&isDivisible(deltaBuffer[1],120)&&isDivisible(deltaBuffer[2],120));return !(c||b);}function isDivisible(b,a){return(Math.floor(b/a)==b/a);}var requestFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(c,b,a){window.setTimeout(c,a||(1000/60));};})();var MutationObserver=window.MutationObserver||window.WebKitMutationObserver;function pulse_(a){var c,d,b;a=a*options.pulseScale;if(a<1){c=a-(1-Math.exp(-a));}else{d=Math.exp(-1);a-=1;b=1-Math.exp(-a);c=d+(b*(1-d));}return c*options.pulseNormalize;}function pulse(a){if(a>=1){return 1;}if(a<=0){return 0;}if(options.pulseNormalize==1){options.pulseNormalize/=pulse_(1);}return pulse_(a);}addEvent("mousedown",mousedown);addEvent("mousewheel",wheel);addEvent("load",init);